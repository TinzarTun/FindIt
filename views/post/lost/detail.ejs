<!-- Breadcrumb -->
<section
  class="py-4 bg-white border-b border-gray-200 sticky top-16 z-30 shadow-sm"
>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <nav class="flex items-center space-x-2 text-sm">
      <a href="/" class="text-gray-500 hover:text-primary-600 transition-colors"
        >Home</a
      >
      <i data-lucide="chevron-right" class="h-4 w-4 text-gray-400"></i>
      <a
        href="/lost"
        class="text-gray-500 hover:text-primary-600 transition-colors"
        >Lost Items</a
      >
      <i data-lucide="chevron-right" class="h-4 w-4 text-gray-400"></i>
      <span class="text-gray-900 font-medium" id="breadcrumb-title"
        ><%= lostItem.title %></span
      >
    </nav>
  </div>
</section>

<!-- Item Details -->
<section class="py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-8">
        <!-- Item Images and Basic Info -->
        <div
          class="<%= lostItem.featured ? 'bg-purple-100 border-purple-500' : 'bg-white' %> rounded-2xl shadow-lg border border-gray-100 overflow-hidden animate-fade-in"
        >
          <!-- Item Images Gallery -->
          <div class="relative">
            <div
              class="h-64 sm:h-80 lg:h-96 bg-gray-100 flex items-center justify-center relative"
            >
              <!-- Main Image Display -->
              <img
                id="main-item-image"
                src="<%= lostItem.images && lostItem.images.length > 0 ? '/uploads/lost-items/' + lostItem.images[0] : 'https://cdn-icons-png.flaticon.com/512/1829/1829586.png' %>"
                alt="Lost Item Image"
                class="w-full h-full object-contain"
              />

              <!-- Featured Badge -->
              <% if (lostItem.featured) { %>
              <div class="absolute top-4 left-4">
                <span
                  class="bg-purple-500 text-white text-sm font-semibold px-3 py-1 rounded-full"
                >
                  <i data-lucide="star" class="h-4 w-4 mr-1 inline"></i>
                  Featured
                </span>
              </div>
              <% } %>

              <!-- Status Badge -->
              <div class="absolute top-4 right-4">
                <span
                  class="bg-red-200 text-red-800 text-sm font-semibold px-3 py-1 rounded-full border border-red-300"
                >
                  <i data-lucide="search-x" class="h-4 w-4 mr-1 inline"></i>
                  <%= lostItem.status.toUpperCase() %>
                </span>
              </div>
            </div>

            <!-- Image Thumbnails -->
            <% if (lostItem.images && lostItem.images.length > 1) { %>
            <div class="absolute bottom-4 left-4 right-4">
              <div
                id="thumbnail-gallery"
                class="flex space-x-2 overflow-x-auto justify-center"
              >
                <!-- Thumbnails are now directly in HTML -->
                <% lostItem.images.forEach((img, index) => { %>
                <img
                  src="/uploads/lost-items/<%= img %>"
                  alt="Lost Item Thumbnail <%= index + 1 %>"
                  class="w-16 h-16 object-cover rounded-lg border-2 <%= index === 0 ? 'border-red-500' : 'border-white' %> cursor-pointer hover:border-red-500 transition-all duration-200 shadow-sm thumbnail"
                  data-full-src="/uploads/lost-items/<%= img %>"
                />
                <% }) %>
              </div>
            </div>
            <% } %>
          </div>

          <!-- Item Details -->
          <div class="px-6 sm:px-8 py-6">
            <div
              class="flex flex-col sm:flex-row sm:items-start sm:justify-between mb-6"
            >
              <div class="mb-4 sm:mb-0">
                <h1
                  id="item-title"
                  class="text-2xl sm:text-3xl font-bold text-gray-900 mb-2"
                >
                  <%= lostItem.title %>
                </h1>
                <div
                  class="flex flex-wrap items-center gap-4 text-sm text-gray-600"
                >
                  <div class="flex items-center">
                    <i data-lucide="calendar" class="h-4 w-4 mr-1"></i>
                    <span id="item-lost-date"
                      >Lost on <%= lostItem.lostDate.toDateString() %></span
                    >
                  </div>
                  <div class="flex items-center">
                    <i data-lucide="clock" class="h-4 w-4 mr-1"></i>
                    <span id="item-time-ago"
                      ><%= timeAgo(lostItem.lostDate) %></span
                    >
                  </div>
                  <div class="flex items-center">
                    <i data-lucide="tag" class="h-4 w-4 mr-1"></i>
                    <span id="item-category"
                      ><%= lostItem.category.name %></span
                    >
                  </div>
                </div>
              </div>
              <% if (lostItem.reward) { %>
              <div id="reward-section" class="text-right">
                <div
                  id="item-reward"
                  class="text-lg font-semibold text-yellow-600 mb-1"
                >
                  MMK <%= lostItem.reward.toLocaleString('en-US') %>
                </div>
                <div class="text-sm text-gray-600">Reward Offered</div>
              </div>
              <% } %>
            </div>
            <!-- Description -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-3">
                Description
              </h3>
              <p id="item-description" class="text-gray-700 leading-relaxed">
                <%= lostItem.description %>
              </p>
            </div>
            <!-- Location Details -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-3">
                Lost Location
              </h3>
              <div class="bg-gray-50 rounded-lg p-4">
                <div class="flex items-start space-x-3">
                  <i
                    data-lucide="map-pin"
                    class="h-5 w-5 text-red-500 mt-0.5 flex-shrink-0"
                  ></i>
                  <div>
                    <p
                      id="lost-location-main"
                      class="font-medium text-gray-900"
                    >
                      <%= lostItem.lostLocation %>
                    </p>
                    <p
                      id="lost-location-details"
                      class="text-sm text-gray-600 mt-1"
                    >
                      <%= lostItem.locationDetails %>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <!-- Claims Status -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold text-gray-900 mb-3">
                Claims Status
              </h3>
              <div class="space-y-3">
                <div
                  class="flex items-center justify-between p-3 bg-yellow-50 border border-yellow-200 rounded-lg"
                >
                  <div class="flex items-center">
                    <i
                      data-lucide="clock"
                      class="h-4 w-4 text-yellow-600 mr-2"
                    ></i>
                    <span
                      id="claims-summary"
                      class="text-sm font-medium text-yellow-800"
                      >3 claims pending review</span
                    >
                  </div>
                  <span
                    id="claims-status-badge"
                    class="text-xs text-yellow-600 bg-yellow-100 px-2 py-1 rounded-full"
                    >PENDING</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Similar Lost Items -->
        <div
          class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden animate-slide-in-left"
        >
          <div class="px-6 sm:px-8 py-6 border-b border-gray-100 bg-gray-50">
            <h3 class="text-xl font-bold text-gray-900 flex items-center">
              <i data-lucide="search" class="h-5 w-5 mr-2 text-primary-600"></i>
              Similar Lost Items
            </h3>
          </div>
          <div class="px-6 sm:px-8 py-6">
            <div
              class="grid grid-cols-1 sm:grid-cols-2 gap-4"
              id="similar-items-grid"
            >
              <% if (similarItems && similarItems.length > 0) { %> <%
              similarItems.forEach(item => { %>
              <a
                href="/lost/detail/<%= item.id %>"
                class="block border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer"
              >
                <div class="flex items-center space-x-3">
                  <div
                    class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden"
                  >
                    <img
                      src="<%= (item.images && item.images.length > 0) ? ('/uploads/lost-items/' + item.images[0]) : 'https://cdn-icons-png.flaticon.com/512/1829/1829586.png' %>"
                      alt="<%= item.title %>"
                      class="w-full h-full object-cover"
                    />
                  </div>
                  <div class="flex-1">
                    <h4 class="font-medium text-gray-900"><%= item.title %></h4>
                    <p class="text-sm text-gray-600">
                      Lost in <%= item.lostLocation %>
                    </p>
                    <p class="text-xs text-gray-500">
                      <%= timeAgo(item.lostDate) %> • <%= item.category.name %>
                    </p>
                  </div>
                </div>
              </a>
              <% }) %> <% } else { %>
              <p class="text-gray-500">No similar items found.</p>
              <% } %>
            </div>
          </div>
        </div>
      </div>
      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Contact Owner -->
        <div
          class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden animate-slide-in-right"
        >
          <div class="px-6 py-6 border-b border-gray-100 bg-gray-50">
            <h3 class="text-lg font-bold text-gray-900 flex items-center">
              <i data-lucide="user" class="h-5 w-5 mr-2 text-primary-600"></i>
              Contact Owner
            </h3>
          </div>
          <div class="px-6 py-6">
            <!-- Owner Info -->
            <div class="flex items-center space-x-3 mb-6">
              <div class="relative">
                <a href="/user/view/<%= lostItem.user.id %>">
                  <img
                    id="owner-avatar"
                    src="<%= lostItem.user.avatar 
                    ? '/uploads/avatar/' + lostItem.user.avatar + '?height=50&width=50'
                    : 'https://cdn-icons-png.flaticon.com/512/847/847969.png?height=50&width=50' %>"
                    alt="<%= lostItem.user.name %>"
                    class="w-12 h-12 rounded-full border-2 border-gray-200"
                  />
                </a>
                <!-- Verified Badge -->
                <% if (lostItem.user.verified) { %>
                <div
                  id="owner-verified-badge"
                  class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-white flex items-center justify-center"
                >
                  <i data-lucide="check" class="h-3 w-3 text-white"></i>
                </div>
                <% } else { %>
                <div
                  id="owner-verified-badge"
                  class="absolute -bottom-1 -right-1 w-5 h-5 bg-yellow-500 rounded-full border-2 border-white flex items-center justify-center"
                >
                  <i data-lucide="hourglass" class="h-3 w-3 text-white"></i>
                </div>
                <% } %>
              </div>
              <div>
                <a href="/user/view/<%= lostItem.user.id %>">
                  <h4 id="owner-name" class="font-semibold text-gray-900">
                    <%= lostItem.user.name %>
                  </h4>
                </a>
                <div class="flex items-center text-sm text-gray-600">
                  Member since <%= new
                  Date(lostItem.user.createdAt).getFullYear() %>
                </div>
                <div id="owner-member-stats" class="text-xs text-gray-500">
                  <%= lostItem.user.lostItems.length %> lost items posted
                </div>
              </div>
            </div>

            <!-- Contact Buttons -->
            <div class="space-y-3">
              <button
                onclick="openContactModal()"
                class="w-full bg-gradient-to-r from-primary-600 to-primary-700 text-white px-4 py-3 rounded-lg hover:from-primary-700 hover:to-primary-800 hover:shadow-lg transform hover:scale-105 transition-all duration-200 font-medium"
              >
                <i data-lucide="message-circle" class="h-4 w-4 mr-2 inline"></i>
                Send Message
              </button>
              <button
                id="call-owner-button"
                class="w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium"
              >
                <i data-lucide="phone" class="h-4 w-4 mr-2 inline"></i>
                Call Owner
              </button>
              <button
                class="w-full border border-gray-300 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium"
              >
                <i data-lucide="share-2" class="h-4 w-4 mr-2 inline"></i>
                Share This Post
              </button>
            </div>
            <!-- Safety Tips -->
            <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
              <div class="flex items-start">
                <i
                  data-lucide="shield"
                  class="h-5 w-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"
                ></i>
                <div>
                  <h5 class="text-sm font-semibold text-blue-900 mb-1">
                    Safety Tips
                  </h5>
                  <ul class="text-xs text-blue-800 space-y-1">
                    <li>• Meet in public places</li>
                    <li>• Verify item details before meeting</li>
                    <li>• Bring a friend if possible</li>
                    <li>• Trust your instincts</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Item Statistics -->
        <div
          class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden animate-scale-in"
        >
          <div class="px-6 py-6 border-b border-gray-100 bg-gray-50">
            <h3 class="text-lg font-bold text-gray-900 flex items-center">
              <i
                data-lucide="bar-chart-3"
                class="h-5 w-5 mr-2 text-primary-600"
              ></i>
              Post Statistics
            </h3>
          </div>
          <div class="px-6 py-6">
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">Views</span>
                <span id="stats-views" class="font-semibold text-gray-900"
                  >156</span
                >
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">Shares</span>
                <span id="stats-shares" class="font-semibold text-gray-900"
                  >12</span
                >
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">Messages</span>
                <span id="stats-messages" class="font-semibold text-gray-900"
                  >8</span
                >
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">Active Claims</span>
                <span
                  id="stats-active-claims"
                  class="font-semibold text-orange-600"
                  >3</span
                >
              </div>
              <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">Status</span>
                <span id="stats-status" class="font-semibold text-red-600"
                  ><%= lostItem.status.toUpperCase() %></span
                >
              </div>
            </div>
          </div>
        </div>
        <!-- Safety Guidelines -->
        <div
          class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden"
        >
          <div class="px-6 py-6 border-b border-gray-100 bg-gray-50">
            <h3 class="text-lg font-bold text-gray-900 flex items-center">
              <i data-lucide="shield" class="h-5 w-5 mr-2 text-primary-600"></i>
              Safety Guidelines
            </h3>
          </div>
          <div class="px-6 py-6">
            <ul class="text-sm text-gray-700 space-y-2">
              <li class="flex items-start">
                <i
                  data-lucide="check"
                  class="h-4 w-4 text-green-500 mt-0.5 mr-2 flex-shrink-0"
                ></i>
                Meet in public places during daylight
              </li>
              <li class="flex items-start">
                <i
                  data-lucide="check"
                  class="h-4 w-4 text-green-500 mt-0.5 mr-2 flex-shrink-0"
                ></i>
                Bring identification for verification
              </li>
              <li class="flex items-start">
                <i
                  data-lucide="check"
                  class="h-4 w-4 text-green-500 mt-0.5 mr-2 flex-shrink-0"
                ></i>
                Inform someone about the meeting
              </li>
              <li class="flex items-start">
                <i
                  data-lucide="check"
                  class="h-4 w-4 text-green-500 mt-0.5 mr-2 flex-shrink-0"
                ></i>
                Trust your instincts
              </li>
            </ul>
          </div>
        </div>
        <!-- Report Post -->
        <div
          class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden"
        >
          <div class="px-6 py-6">
            <button
              class="w-full text-red-600 hover:text-red-700 text-sm font-medium transition-colors flex items-center justify-center"
            >
              <i data-lucide="flag" class="h-4 w-4 mr-2"></i>
              Report This Post
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Contact Modal -->
<div
  id="contactModal"
  class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4"
>
  <div
    class="bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto"
  >
    <div
      class="px-6 py-4 border-b border-gray-200 flex items-center justify-between"
    >
      <h3 class="text-xl font-bold text-gray-900">Contact Owner</h3>
      <button
        onclick="closeContactModal()"
        class="text-gray-400 hover:text-gray-600 transition-colors"
      >
        <i data-lucide="x" class="h-6 w-6"></i>
      </button>
    </div>
    <div class="px-6 py-6">
      <form class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Your Name</label
          >
          <input
            type="text"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
            placeholder="Enter your name"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Your Email</label
          >
          <input
            type="email"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
            placeholder="Enter your email"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Your Phone</label
          >
          <input
            type="tel"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
            placeholder="Enter your phone number"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Message</label
          >
          <textarea
            rows="4"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
            placeholder="I think I may have found your iPhone..."
          ></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Evidence (Optional)</label
          >
          <input
            type="file"
            multiple
            accept="image/*"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors"
          />
          <p class="text-xs text-gray-500 mt-1">
            Upload photos as evidence if you found the item
          </p>
        </div>
        <div class="flex justify-end space-x-4 pt-4">
          <button
            type="button"
            onclick="closeContactModal()"
            class="px-6 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium"
          >
            Cancel
          </button>
          <button
            type="submit"
            class="px-6 py-2.5 bg-gradient-to-r from-primary-600 to-primary-700 text-white rounded-lg hover:from-primary-700 hover:to-primary-800 transition-all font-medium"
          >
            Send Message
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const thumbnails = document.querySelectorAll(".thumbnail");
    const mainImage = document.getElementById("main-item-image");

    thumbnails.forEach((thumb) => {
      thumb.addEventListener("click", () => {
        const fullSrc = thumb.getAttribute("data-full-src");
        mainImage.setAttribute("src", fullSrc);

        // Update borders to highlight selected thumbnail
        thumbnails.forEach((t) => {
          t.classList.remove("border-red-500");
          t.classList.add("border-white");
        });
        thumb.classList.remove("border-white");
        thumb.classList.add("border-red-500");
      });
    });
  });
</script>
